<!-- 新建模板 -->
{% extends 'base.html' %}

{% block title %}：新建模板{% endblock %}
{% block header %}<h3>新建模板</h3>{% endblock %}
{% block stylesheet %}
    <script src = "{{ url_for('static', filename = 'plain-draggable/plain-draggable.min.js') }}"></script>
    <link rel = "stylesheet" href = "{{ url_for('static', filename = 'css/base.css') }}">
	<link rel = "stylesheet" href = "{{ url_for('static', filename = 'css/map/smartLayout/createTemplate.css') }}">
	<link rel = "stylesheet" type = "text/css" href = "{{ url_for('static', filename = 'images/icon/iconfont/iconfont.css') }}"> 
{% endblock %}

{% block content %}
    <div id = 'createTemplate'>
        <div id = 'templateInfo'>
            <div id = 'layoutMenu'>
                <label onclick = 'selectPage(this.id)' id = template_label class = 'label_selected'>模板信息</label>
                <label onclick = 'selectPage(this.id)' id = model_label class = 'label_unselected'>模型信息</label>
            </div>
            <form id = 'template_page' class = 'label_page' method = 'POST' action = "{{ url_for('map.smartLayout_createTemplate') }}">
                <div id = 'title_inputBox' class = 'inputBox'>
                    <label for = 'title'>模板标题：</label>
                    <input name = 'title' placeholder = '请输入模板标题'>
                </div>
                <div id = 'func_inputBox' class = 'inputBox'>
                    <label for = 'func'>房间类型：</label>
                    <select id = 'funcSelector' name = 'func' required>
                        <option id = 'funcChoice_1' class = 'funcChoice' value = '客厅'>客厅</option>
                        <option id = 'funcChoice_2' class = 'funcChoice' value = '厨房'>厨房</option>
                        <option id = 'funcChoice_3' class = 'funcChoice' value = '卧室'>卧室</option>
                        <option id = 'funcChoice_4' class = 'funcChoice' value = '卫生间'>卫生间</option>
                    </select>
                </div>
                <div id = 'width_inputBox' class = 'inputBox'>
                    <label for = 'width'>房间宽度：</label>
                    <input type = 'number' step = '0.01' min = 0 max = 10 name = 'width' value = 0 onchange = "roomSizeSet(this, 1);" required>m
                    &emsp;<span>(0-10.00m)</span>
                </div>
                <div id = 'height_inputBox' class = 'inputBox'>
                    <label for = 'height'>房间长度：</label>
                    <input type = 'number' step = '0.01' min = 0 max = 5.6 name = 'height' value = 0 onchange = "roomSizeSet(this, 2);" required>m
                    &emsp;<span>(0-5.60m)</span>
                </div>
                <div id = 'floor_inputBox' class = 'inputBox'>
                    <label for = 'floor'>房间地板：</label>
                    <input id = 'floorInput' name = 'floor' value = '1' style = 'display: none;'>
                    <div id = 'floorSelector'>
                        <img src = "{{ url_for('static', filename = 'images/template/floor/1.jpg') }}" onclick = 'selectFloor(this)' id = '1_floor' class = 'floorBox floorSelected' alt = '无' title = '无'>
                        <img src = "{{ url_for('static', filename = 'images/template/floor/2.jpg') }}" onclick = 'selectFloor(this)' id = '2_floor' class = 'floorBox' alt = '木地板' title = '木地板'>
                        <img src = "{{ url_for('static', filename = 'images/template/floor/3.jpg') }}" onclick = 'selectFloor(this)' id = '3_floor' class = 'floorBox' alt = '云石地板' title = '云石地板'>
                        <img src = "{{ url_for('static', filename = 'images/template/floor/4.jpg') }}" onclick = 'selectFloor(this)' id = '4_floor' class = 'floorBox' alt = '大理石地板' title = '大理石地板'>
                    </div>
                </div>
                <div id = 'style_inputBox' class = 'inputBox'>
                    <label for = 'style'>房间风格：</label>
                    <table id = 'styleSelector'>
                        <tr>
                            <td><input type = 'checkbox' id = 'styleChoice_1' class = 'styleChoice' name = 'style' value = 'Americano'>美式</td>
                            <td><input type = 'checkbox' id = 'styleChoice_2' class = 'styleChoice' name = 'style' value = 'Arcadian'>田园式</td>
                            <td><input type = 'checkbox' id = 'styleChoice_3' class = 'styleChoice' name = 'style' value = 'European'>欧式</td>
                            <td><input type = 'checkbox' id = 'styleChoice_4' class = 'styleChoice' name = 'style' value = 'HongKong'>港式</td>
                        </tr>
                        <tr>
                            <td><input type = 'checkbox' id = 'styleChoice_5' class = 'styleChoice' name = 'style' value = 'JaneEuropean'>简欧</td>
                            <td><input type = 'checkbox' id = 'styleChoice_6' class = 'styleChoice' name = 'style' value = 'Japanese'>日式</td>
                            <td><input type = 'checkbox' id = 'styleChoice_7' class = 'styleChoice' name = 'style' value = 'Mediterranean'>地中海式</td>
                            <td><input type = 'checkbox' id = 'styleChoice_8' class = 'styleChoice' name = 'style' value = 'MildLuxury'>轻奢</td></tr>
                        <tr>
                            <td><input type = 'checkbox' id = 'styleChoice_9' class = 'styleChoice' name = 'style' value = 'Modern'>现代</td>
                            <td><input type = 'checkbox' id = 'styleChoice_10' class = 'styleChoice' name = 'style' value = 'NeoChinese'>新中式</td>
                            <td><input type = 'checkbox' id = 'styleChoice_11' class = 'styleChoice' name = 'style' value = 'NorthernEuropean'>北欧</td>
                            <td><input type = 'checkbox' id = 'styleChoice_12' class = 'styleChoice' name = 'style' value = 'Postmodern'>后现代</td>
                        </tr>
                    </table>
                </div>
                <div id = 'remark_inputBox' class = 'inputBox'>
                    <label for = 'remark'>模板描述：</label>
                    <textarea name = 'remark' placeholder = '请输入模板描述'></textarea>
                </div>
                <div id = 'tips_inputBox' class = 'inputBox'>
                    <label id = 'tips'>画图提示：</label>
                    <p>1. 输入房间长宽后生成房间轮廓；</p>
                    <p>2. 点击模型库中模型上添加按钮以添加模型；</p>
                    <p>3. 单击选中模型以进行模型修改；</p>
                    <p>4. 双击模型以启动/关闭模型拖拽；</p>
                </div>
                <div id = 'save_inputBox' class = 'inputBox'>
                    <input type = 'submit' value = '保存模板'>
                </div>
            </form>
            <div id = 'model_page' class = 'label_page' style = 'display: none;'>
                <div id = 'modelName_inputBox' class = 'inputBox'>
                    <label for = 'modelName'>模型名称：</label>
                    <input name = 'modelName' value = '暂无选中模型' readonly>
                </div>
                <div id = 'type_inputBox' class = 'inputBox'>
                    <label for = 'type'>模型类别：</label>
                    <input name = 'type' value = '暂无选中模型' readonly>
                </div>
                <div id = 'scale_inputBox' class = 'inputArea'>
                    <label for = 'scale'>模型尺寸：</label>
                    <input type = 'number' min = '0.5' max = '1.5' step = '0.1' value = '1' required>
                    <!-- <div id = 'lockWAndH'><input type = 'checkbox'><span>锁定长宽比</span></div>
                    <div id = 'width_inputBox' class = 'inputArea_box'>
                        <label for = 'width'>模型宽度：</label>
                        <input type = 'number' min = '0' max = '10' required>m
                    </div>
                    <div id = 'height_inputBox' class = 'inputArea_box'>
                        <label for = 'height'>模型长度：</label>
                        <input type = 'number' min = '0'  max = '5.6' required>m
                    </div> -->
                </div>
                <div id = 'angle_inputBox' class = 'inputBox'>
                    <label for = 'angle'>旋转角度：</label>
                    <input type = 'number' min = '-180' max = '180' step = '90' value = '0' required>°
                </div>
                <div id = 'color_inputBox' class = 'inputBox'>
                    <label for = 'color'>模型颜色：</label>
                    <input id = 'colorInput' name = 'color' value = 'red' style = 'display: none;'>
                    <div id = 'colorSelector'>
                        <div>
                            <div onclick = 'selectColor(this)' id = 'red_color' class = 'colorBox colorSelected' title = '红色'></div>
                            <div onclick = 'selectColor(this)' id = 'orange_color' class = 'colorBox' title = '橙色'></div>
                            <div onclick = 'selectColor(this)' id = 'yellow_color' class = 'colorBox' title = '黄色'></div>
                            <div onclick = 'selectColor(this)' id = 'green_color' class = 'colorBox' title = '绿色'></div>
                            <div onclick = 'selectColor(this)' id = 'blue_color' class = 'colorBox' title = '蓝色'></div>
                            <div onclick = 'selectColor(this)' id = 'purple_color' class = 'colorBox' title = '紫色'></div>
                        </div>
                        <div>
                            <div onclick = 'selectColor(this)' id = 'grey_color' class = 'colorBox' title = '灰色'></div>
                            <div onclick = 'selectColor(this)' id = 'pink_color' class = 'colorBox' title = '粉色'></div>
                            <div onclick = 'selectColor(this)' id = 'wood_color' class = 'colorBox' title = '木色'></div>
                            <div onclick = 'selectColor(this)' id = 'white_color' class = 'colorBox' title = '白色'></div>
                            <div onclick = 'selectColor(this)' id = 'brown_color' class = 'colorBox' title = '褐色'></div>
                            <div onclick = 'selectColor(this)' id = 'beige_color' class = 'colorBox' title = '米色'></div>
                        </div>
                    </div>
                </div>
                <div id = 'delete_inputBox' class = 'inputBox'>
                    <input type = 'button' value = '删除模型'>
                </div>
            </div>
            <div id = 'modelBank'>
                <div id = 'modelBankMain'>
                    <div id = 'modelTitle'>
                        <label>模型库</label>
                    </div>
                    <div id = 'modelMenu'>
                        <label>选择模型：</label>
                        <select oninput = 'showModels(this.value)' required>
                            <optgroup id = 'interiorFinish' label = "硬装">
                                <option class = 'interiorFinish' value = 'door'>门</option>
                                <option class = 'interiorFinish' value = 'window'>窗</option>
                            </optgroup>
                            <optgroup id = 'furniture' label = '家具'>
                                <option class = 'furniture' value = 'sofa'>沙发</option>
                                <option class = 'furniture' value = 'bed'>床</option>
                                <option class = 'furniture' value = 'desk'>桌子</option>
                                <option class = 'furniture' value = 'chair'>椅子|凳子</option>
                                <option class = 'furniture' value = 'cabinetRack'>柜架</option>
                            </optgroup>
                            <optgroup id = 'kitchenAndBathroom' label = '厨卫'>
                                <option class = 'kitchenAndBathroom' value = 'cupboard'>橱柜</option>
                                <option class = 'kitchenAndBathroom' value = 'bathroomCabinet'>浴室柜</option>
                                <option class = 'kitchenAndBathroom' value = 'washStand'>洗手台</option>
                                <option class = 'kitchenAndBathroom' value = 'toilet'>马桶</option>
                                <option class = 'kitchenAndBathroom' value = 'bathtub'>浴缸</option>
                            </optgroup>
                        </select>
                    </div>
                    <div id = 'modelImages'>
                        {% if g.user['status'] == 1 %}
                            <div id = 'addModelBox' class = 'modelBox'>
                                <a href = "{{ url_for('map.smartLayout_createModel') }}"><span>⊕</span>&nbsp;新建模型</a>
                            </div>
                        {% endif %}
                        <div id = 'door_way' class = 'modelBox door'>
                            <div class = 'modelTitle'>门道</div>
                            <svg xmlns = 'http://www.w3.org/2000/svg' version = '1.1'>
                                <g transform = 'translate(54.15, 60.4) rotate(0, 0, 0) scale(1, 1)'>
                                    <path d = 'M 0, 0 L 0, 20 L 60, 20 L 60, 0 Z' stroke-width = '1' fill = '#ccc' stroke = '#494646' stroke-dasharray = '5, 5'></path>
                                    <path d = 'M 0, 0 L 0, 20 L 5, 20 L 5, 0 Z' stroke-width = '1' fill = 'white' stroke = '#494646' stroke-dasharray = 'none'></path>
                                    <path d = 'M 55, 0 L 55, 20 L 60, 20 L 60, 0 Z' stroke-width = '1' fill = 'white' stroke = '#494646' stroke-dasharray = 'none'></path>
                                    <rect class = 'draggable' x = '0' y = '0' width = '60' height = '20'></rect>
                                </g>
                            </svg>
                            <div class = 'modelAdd'>
                                 <input type = 'button' value = '添加' onclick = 'addModel(this)'>
                            </div>
                        </div>
                        <div id = 'door_single' class = 'modelBox door'>
                            <div class = 'modelTitle'>单开门</div>
                            <svg xmlns = 'http://www.w3.org/2000/svg' version = '1.1'>
                                <g transform = 'translate(54.15, 30.4) rotate(0, 0, 0) scale(1, 1)'>
                                    <path d = 'M 0, 60 L 0, 80 L 60, 80 L 60, 60 Z' stroke-width = '1' fill = '#ccc' stroke = 'none' stroke-dasharray = ''></path>
                                    <path d = 'M 0, 60 L 0, 0  A 60 60 0, 0, 1, 60 60' stroke-width = '1' fill = 'white' stroke = '#666' stroke-dasharray = ''></path>
                                    <rect class = 'draggable' x = '0' y = '60' width = '60' height = '20'></rect>
                                </g>
                            </svg>
                            <div class = 'modelAdd'>
                                 <input type = 'button' value = '添加' onclick = 'addModel(this)'>
                            </div>
                        </div>
                        <div id = 'door_double' class = 'modelBox door'>
                            <div class = 'modelTitle'>双开门</div>
                            <svg xmlns = 'http://www.w3.org/2000/svg' version = '1.1'>
                                <g transform = 'translate(54.15, 45.4) rotate(0, 0, 0) scale(1, 1)'>
                                    <path d = 'M 0, 30 L 0, 50 L 60, 50 L 60, 30 Z' stroke-width = '1' fill = '#ccc' stroke = 'none' stroke-dasharray = ''></path>
                                    <path d = 'M 0, 30 L 0, 0  A 30 30, 0, 0, 1, 30 30' stroke-width = '1' fill = 'white' stroke = '#666' stroke-dasharray = ''></path>
                                    <path d = 'M 60, 30 L 60, 0  A 30 30, 0, 0, 0, 30 30' stroke-width = '1' fill = 'white' stroke = '#666' stroke-dasharray = ''></path>
                                    <rect class = 'draggable' x = '0' y = '30' width = '60' height = '20'></rect>
                                </g>
                            </svg>
                            <div class = 'modelAdd'>
                                 <input type = 'button' value = '添加' onclick = 'addModel(this)'>
                            </div>
                        </div>
                        <div id = 'door_slide' class = 'modelBox door'>
                            <div class = 'modelTitle'>滑动门</div>
                            <svg xmlns = 'http://www.w3.org/2000/svg' version = '1.1'>
                                <g transform = 'translate(54.15, 57.9) rotate(0, 0, 0) scale(1, 1)'>
                                    <path d = 'M 0, 1 L 0, 25 L 60, 25 L 60, 1 Z' stroke-width = '1' fill = '#ccc' stroke = 'none' stroke-dasharray = 'none'></path>
                                    <path d = 'M 0, 5 L 0, 25 M 60, 25 L 60, 5' stroke-width = '1' fill = 'white' stroke = '#494646' stroke-dasharray = '5 5'></path>
                                    <path d = 'M 0, 5 L 0, 0 L 60, 0 L 60, 5 Z' stroke-width = '1' fill = 'url(#hatch)' stroke = '#494646' stroke-dasharray = ''></path>
                                    <rect class = 'draggable' x = '0' y = '5' width = '60' height = '20'></rect>
                                </g>
                            </svg>
                            <div class = 'modelAdd'>
                                 <input type = 'button' value = '添加' onclick = 'addModel(this)'>
                            </div>
                        </div>
                        <div id = 'window_fixed' class = 'modelBox window'>
                            <div class = 'modelTitle'>固定窗</div>
                            <svg xmlns = 'http://www.w3.org/2000/svg' version = '1.1'>
                                <g transform = 'translate(54.15, 60.4) rotate(0, 0, 0) scale(1, 1)'>
                                    <path d = 'M 0, 8 L 0, 12 L 60, 12 L 60, 8 Z' stroke-width = '1' fill = '#ccc' stroke = 'none' stroke-dasharray = ''></path>
                                    <path d = 'M 0, 0 L 0, 20 M 60, 20 L 60, 0' stroke-width = '1' fill = 'white' stroke = '#ccc' stroke-dasharray = ''></path>
                                    <rect class = 'draggable' x = '0' y = '0' width = '60' height = '20'></rect>
                                </g>
                            </svg>
                            <div class = 'modelAdd'>
                                 <input type = 'button' value = '添加' onclick = 'addModel(this)'>
                            </div>
                        </div>
                        <div id = 'window_single' class = 'modelBox window'>
                            <div class = 'modelTitle'>单开窗</div>
                            <svg xmlns = 'http://www.w3.org/2000/svg' version = '1.1'>
                                <g transform = 'translate(54.15, 45.4) rotate(0, 0, 0) scale(1, 1)'>
                                    <path d = 'M 0, 38 L 0, 42 L 60, 42 L 60, 38 Z' stroke-width = '1' fill = '#ccc' stroke = 'none' stroke-dasharray = ''></path>
                                    <path d = 'M 0, 30 L 0, 50 M 60, 50 L 60, 30' stroke-width = '1' fill = 'white' stroke = '#ccc' stroke-dasharray = ''></path>
                                    <path d = 'M 0, 30 L 51.96, 0 A 60 60, 0, 0, 1, 60 30' stroke-width = '1' fill = 'white' stroke = '#666' stroke-dasharray = ''></path>
                                    <rect class = 'draggable' x = '0' y = '30' width = '60' height = '20'></rect>
                                </g>
                            </svg>
                            <div class = 'modelAdd'>
                                 <input type = 'button' value = '添加' onclick = 'addModel(this)'>
                            </div>
                        </div>
                        <div id = 'window_double' class = 'modelBox window'>
                            <div class = 'modelTitle'>双开窗</div>
                            <svg xmlns = 'http://www.w3.org/2000/svg' version = '1.1'>
                                <g transform = 'translate(54.15, 52.9) rotate(0, 0, 0) scale(1, 1)'>
                                    <path d = 'M 0, 23 L 0, 27 L 60, 27 L 60, 23 Z' stroke-width = '1' fill = '#ccc' stroke = 'none' stroke-dasharray = ''></path>
                                    <path d = 'M 0, 15 L 0, 35 M 60, 35 L 60, 15' stroke-width = '1' fill = 'white' stroke = '#ccc' stroke-dasharray = ''></path>
                                    <path d = 'M 0, 15 L 25.98, 0 A 30 30, 0, 0, 1, 30, 15' stroke-width = '1' fill = 'white' stroke = '#666' stroke-dasharray = ''></path>
                                    <path d = 'M 60, 15 L 34.02, 0 A 30 30, 0, 0, 0, 30 15' stroke-width = '1' fill = 'white' stroke = '#666' stroke-dasharray = ''></path>
                                    <rect class = 'draggable' x = '0' y = '15' width = '60' height = '20'></rect>
                                </g>
                            </svg>
                            <div class = 'modelAdd'>
                                 <input type = 'button' value = '添加' onclick = 'addModel(this)'>
                            </div>
                        </div>
                        <div id = 'window_slide' class = 'modelBox window'>
                            <div class = 'modelTitle'>滑动窗</div>
                            <svg xmlns = 'http://www.w3.org/2000/svg' version = '1.1'>
                                <g transform = 'translate(54.15, 60.4) rotate(0, 0, 0) scale(1, 1)'>
                                    <path d = 'M 0, 0 L 0, 20 M 60, 20 L 60, 0' stroke-width = '1' fill = 'white' stroke = '#ccc' stroke-dasharray = ''></path>
                                    <path d = 'M 0, 8 L 0, 10 L 32, 10 L 32, 12 L 33, 12 L 33, 8 Z' stroke-width = '1' fill = '#ccc' stroke = 'none' stroke-dasharray = ''></path>
                                    <path d = 'M 28, 11 L 28, 13 L 60, 13 L 60, 11 L 29, 11 L 29, 9 L 28, 9 Z' stroke-width = '1' fill = '#ccc' stroke = 'none' stroke-dasharray = ''></path>
                                    <rect class = 'draggable' x = '0' y = '0' width = '60' height = '20'></rect>
                                </g>
                            </svg>
                            <div class = 'modelAdd'>
                                 <input type = 'button' value = '添加' onclick = 'addModel(this)'>
                            </div>
                        </div>
                        <div id = 'sofa_single' class = 'modelBox sofa'>
                            <div class = 'modelTitle'>单人沙发</div>
                            <svg xmlns = 'http://www.w3.org/2000/svg' version = '1.1'>
                                <g transform = 'translate(44.15, 34.4) rotate(0, 0, 0) scale(1, 1)'>
                                    <rect x = '15' y = '22' rx = '4' ry = '4' width = '50' height = '50' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect x = '0' y = '20' rx = '2' ry = '3' width = '15' height = '45' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect x = '65' y = '20' rx = '2' ry = '3' width = '15' height = '45' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect x = '6' y = '0' rx = '3' ry = '3' width = '68' height = '20' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect class = 'draggable' x = '0' y = '0' width = '80' height = '72'></rect>
                                </g>
                            </svg>
                            <div class = 'modelAdd'>
                                 <input type = 'button' value = '添加' onclick = 'addModel(this)'>
                            </div>
                        </div>
                        <div id = 'sofa_double' class = 'modelBox sofa'>
                            <div class = 'modelTitle'>双人沙发</div>
                            <svg xmlns = 'http://www.w3.org/2000/svg' version = '1.1'>
                                <g transform = 'translate(19.15, 34.4) rotate(0, 0, 0) scale(1, 1)'>
                                    <rect x = '15' y = '22' rx = '4' ry = '4' width = '50' height = '50' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect x = '65' y = '22' rx = '4' ry = '4' width = '50' height = '50' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect x = '0' y = '20' rx = '2' ry = '3' width = '15' height = '45' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect x = '115' y = '20' rx = '2' ry = '3' width = '15' height = '45' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect x = '6' y = '0' rx = '3' ry = '3' width = '118' height = '20' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect class = 'draggable' x = '0' y = '0' width = '130' height = '72'></rect>
                                </g>
                            </svg>
                            <div class = 'modelAdd'>
                                 <input type = 'button' value = '添加' onclick = 'addModel(this)'>
                            </div>
                        </div>
                        <div id = 'bed_single' class = 'modelBox bed'>
                            <div class = 'modelTitle'>单人床</div>
                            <svg xmlns = 'http://www.w3.org/2000/svg' version = '1.1'>
                                <g transform = 'translate(57.15, 10.4) rotate(0, 0, 0) scale(0.6, 0.6)'>
                                    <rect x = '0' y = '0' rx = '4' ry = '4' width = '90' height = '200' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <path d = 'M 20, 30 A 15 15, 0, 0, 1, 35 15 L 55, 15 A 15 15, 0, 0, 1, 70 30' stroke-width = '1' fill = 'white' stroke = '#494646'></path>
                                    <line x1 = '0' y1 = '30' x2 = '90' y2 = '30' style = 'stroke:#494646; stroke-width:1; '></line>
                                    <rect class = 'draggable' x = '0' y = '0' width = '90' height = '200'></rect>
                                </g>
                            </svg>
                            <div class = 'modelAdd'>
                                 <input type = 'button' value = '添加' onclick = 'addModel(this)'>
                            </div>
                        </div>
                        <div id = 'bed_double' class = 'modelBox bed'>
                            <div class = 'modelTitle'>双人床</div>
                            <svg xmlns = 'http://www.w3.org/2000/svg' version = '1.1'>
                                <g transform = 'translate(21.15, 10.4) rotate(0, 0, 0) scale(0.6, 0.6)'>
                                    <rect x = '0' y = '0' rx = '4' ry = '4' width = '210' height = '200' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <path d = 'M 38, 30 A 15 15, 0, 0, 1, 53 15 L 73, 15 A 15 15, 0, 0, 1, 88 30' stroke-width = '1' fill = 'white' stroke = '#494646'></path>
                                    <path d = 'M 122, 30 A 15 15, 0, 0, 1, 137 15 L 157, 15 A 15 15, 0, 0, 1, 172 30' stroke-width = '1' fill = 'white' stroke = '#494646'></path>
                                    <line x1 = '0' y1 = '30' x2 = '210' y2 = '30' style = 'stroke:#494646; stroke-width:1; '></line>
                                    <rect class = 'draggable' x = '0' y = '0' width = '210' height = '200'></rect>
                                </g>
                            </svg>
                            <div class = 'modelAdd'>
                                 <input type = 'button' value = '添加' onclick = 'addModel(this)'>
                            </div>
                        </div>
                        <div id = 'desk_rect' class = 'modelBox desk'>
                            <div class = 'modelTitle'>方桌</div>
                            <svg xmlns = 'http://www.w3.org/2000/svg' version = '1.1'>
                                <g transform = 'translate(20.15, 4.4) rotate(0, 0, 0) scale(0.8, 0.8)'>
                                    <rect x = '0' y = '0' rx = '1' ry = '1' width = '160' height = '160' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect x = '2' y = '2' rx = '1' ry = '1' width = '156' height = '156' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect class = 'draggable' x = '0' y = '0' width = '160' height = '160'></rect>
                                </g>
                            </svg>
                            <div class = 'modelAdd'>
                                 <input type = 'button' value = '添加' onclick = 'addModel(this)'>
                            </div>
                        </div>
                        <div id = 'desk_cicle' class = 'modelBox desk'>
                            <div class = 'modelTitle'>圆桌</div>
                            <svg xmlns = 'http://www.w3.org/2000/svg' version = '1.1'>
                                <g transform = 'translate(20.15, 4.4) rotate(0, 0, 0) scale(0.8, 0.8)'>
                                    <circle cx = '80' cy = '80' r = '80' style = 'fill:white; stroke:#494646; stroke-width:1; '></circle>
                                    <circle cx = '80' cy = '80' r = '78' style = 'fill:white; stroke:#494646; stroke-width:1; '></circle>
                                    <rect class = 'draggable' x = '0' y = '0' width = '160' height = '160'></rect>
                                </g>
                            </svg>
                            <div class = 'modelAdd'>
                                 <input type = 'button' value = '添加' onclick = 'addModel(this)'>
                            </div>
                        </div>
                        <div id = 'chair_sit' class = 'modelBox chair'>
                            <div class = 'modelTitle'>坐椅</div>
                            <svg xmlns = 'http://www.w3.org/2000/svg' version = '1.1'>
                                <g transform = 'translate(66.15, 45.2) rotate(0, 0, 0) scale(1.2, 1.2)'>
                                    <rect x = '2' y = '0' width = '26' height = '6' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect x = '0' y = '12' rx = '2' ry = '2' width = '30' height = '30' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect x = '6' y = '6' width = '5' height = '6' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect x = '19' y = '6' width = '5' height = '6' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect class = 'draggable' x = '0' y = '0' width = '30' height = '42'></rect>
                                </g>
                            </svg>
                            <div class = 'modelAdd'>
                                <input type = 'button' value = '添加' onclick = 'addModel(this)'>
                            </div>
                        </div>
                        <div id = 'chair_rely' class = 'modelBox chair'>
                            <div class = 'modelTitle'>靠椅</div>
                            <svg xmlns = 'http://www.w3.org/2000/svg' version = '1.1'>
                                <g transform = 'translate(58.95, 45.2) rotate(0, 0, 0) scale(1.2, 1.2)'>
                                    <rect x = '6' y = '12' rx = '4' ry = '4' width = '30' height = '30' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect x = '0' y = '16' rx = '4' ry = '4' width = '6' height = '22' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect x = '36' y = '16' rx = '4' ry = '4' width = '6' height = '22' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect x = '19' y = '6' width = '4' height = '2' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect x = '19' y = '8' width = '4' height = '2' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect x = '19' y = '10' width = '4' height = '2' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect x = '6' y = '0' width = '30' height = '6' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect class = 'draggable' x = '0' y = '0' width = '42' height = '42'></rect>
                                </g>
                            </svg>
                            <div class = 'modelAdd'>
                                <input type = 'button' value = '添加' onclick = 'addModel(this)'>
                            </div>
                        </div>
                        <div id = 'cabinetRack_push' class = 'modelBox cabinetRack'>
                            <div class = 'modelTitle'>抽屉柜</div>
                            <svg xmlns = 'http://www.w3.org/2000/svg' version = '1.1'>
                                <g transform = 'translate(64.15, 36.9) rotate(0, 0, 0) scale(1, 1)'>
                                    <rect x = '0' y = '0' width = '40' height = '35' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect x = '0' y = '35' width = '40' height = '2' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <path d = 'M 20, 37 L 20, 67 L 17, 61.8 M 20, 67 L 23, 61.8' stroke-width = '1' fill = 'white' stroke = '#494646'></path>
                                    <line x1 = '2' y1 = '67' x2 = '38' y2 = '67' style = 'stroke:#494646; stroke-width:1; '></line>
                                    <rect class = 'draggable' x = '0' y = '0' width = '40' height = '67'></rect>
                                </g>
                            </svg>
                            <div class = 'modelAdd'>
                                <input type = 'button' value = '添加' onclick = 'addModel(this)'>
                            </div>
                        </div>
                        <div id = 'cabinetRack_slide' class = 'modelBox cabinetRack'>
                            <div class = 'modelTitle'>滑动柜</div>
                            <svg xmlns = 'http://www.w3.org/2000/svg' version = '1.1'>
                                <g transform = 'translate(12.15, 46.4) rotate(0, 0, 0) scale(0.8, 0.8)'>
                                    <rect x = '0' y = '0' width = '180' height = '58' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect x = '0' y = '58' width = '180' height = '2' style = 'fill:url(#hatch); stroke:#494646; stroke-width:1; '></rect>
                                    <rect class = 'draggable' x = '0' y = '0' width = '180' height = '60'></rect>
                                </g>
                            </svg>
                            <div class = 'modelAdd'>
                                <input type = 'button' value = '添加' onclick = 'addModel(this)'>
                            </div>
                        </div>
                        <div id = 'cupboard_1' class = 'modelBox cupboard'>
                            <div class = 'modelTitle'>一字型橱柜</div>
                            <svg xmlns = 'http://www.w3.org/2000/svg' version = '1.1'>
                                <g transform = 'translate(0.15, 40.4) rotate(0, 0, 0) scale(0.4, 0.4)'>
                                    <rect x = '0' y = '0' width = '80' height = '68' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect x = '80' y = '0' width = '140' height = '68' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect x = '220' y = '0' width = '80' height = '68' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect x = '300' y = '0' width = '120' height = '70' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect x = '0' y = '68' width = '80' height = '2' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect x = '80' y = '68' width = '70' height = '2' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect x = '150' y = '68' width = '70' height = '2' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect x = '220' y = '68' width = '80' height = '2' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <path d = 'M 0, 70 L 0, 150 A 80 80, 0, 0, 0, 80, 70 L 80, 140 A 70 70, 0, 0, 0, 150 70 A 70 70, 0, 0, 0, 220 140 L 220, 70 L 220, 150 A 80 80, 0, 0, 0, 300 70' stroke-width = '1' fill = 'white' stroke = '#ccc' stroke-dasharray = ''></path>
                                    <circle cx = '120' cy = '40' r = '20' style = 'fill:white; stroke:#494646; stroke-width:1; '></circle>
                                    <circle cx = '180' cy = '40' r = '20' style = 'fill:white; stroke:#494646; stroke-width:1; '></circle>
                                    <circle cx = '120' cy = '40' r = '12' style = 'fill:white; stroke:#494646; stroke-width:1; '></circle>
                                    <circle cx = '180' cy = '40' r = '12' style = 'fill:white; stroke:#494646; stroke-width:1; '></circle>
                                    <line x1 = '95' y1 = '40' x2 = '145' y2 = '40' style = 'fill:white; stroke:#494646; stroke-width:1; '></line>
                                    <line x1 = '120' y1 = '15' x2 = '120' y2 = '65' style = 'fill:white; stroke:#494646; stroke-width:1; '></line>
                                    <line x1 = '155' y1 = '40' x2 = '205' y2 = '40' style = 'fill:white; stroke:#494646; stroke-width:1; '></line>
                                    <line x1 = '180' y1 = '15' x2 = '180' y2 = '65' style = 'fill:white; stroke:#494646; stroke-width:1; '></line>
                                    <circle cx = '145' cy = '62' r = '2' style = 'fill:white; stroke:#494646; stroke-width:1; '></circle>
                                    <circle cx = '155' cy = '62' r = '2' style = 'fill:white; stroke:#494646; stroke-width:1; '></circle>
                                    <rect x = '307' y = '15' rx = '5' ry = '8' width = '50' height = '50' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect x = '363' y = '15' rx = '5' ry = '8' width = '50' height = '50' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <circle cx = '332' cy = '40' r = '6' style = 'fill:white; stroke:#494646; stroke-width:1; '></circle>
                                    <circle cx = '332' cy = '40' r = '4' style = 'fill:white; stroke:#494646; stroke-width:1; '></circle>
                                    <circle cx = '388' cy = '40' r = '6' style = 'fill:white; stroke:#494646; stroke-width:1; '></circle>
                                    <circle cx = '388' cy = '40' r = '4' style = 'fill:white; stroke:#494646; stroke-width:1; '></circle>
                                    <circle cx = '360' cy = '8' r = '5' style = 'fill:white; stroke:#494646; stroke-width:1; '></circle>
                                    <circle cx = '360' cy = '43' r = '5' style = 'fill:white; stroke:#494646; stroke-width:1; ' transform = 'rotate(24, 360, 8)'></circle>
                                    <rect x = '357' y = '8' width = '6'  height = '35' style = 'fill:white; stroke:#494646; stroke-width:1; ' transform = 'rotate(24, 360, 8)'></rect>
                                    <circle cx = '360' cy = '8' r = '3' style = 'fill:white; stroke:#494646; stroke-width:1; '></circle>
                                    <rect class = 'draggable' x = '0' y = '0' width = '420' height = '150'></rect>
                                </g>
                            </svg>
                            <div class = 'modelAdd'>
                                <input type = 'button' value = '添加' onclick = 'addModel(this)'>
                            </div>
                        </div>
                        <div id = 'bathroomCabinet_push' class = 'modelBox bathroomCabinet'>
                            <div class = 'modelTitle'>挂墙式双开门浴室柜</div>
                            <svg xmlns = 'http://www.w3.org/2000/svg' version = '1.1'>
                                <g transform = 'translate(54.15, 32.525) rotate(0, 0, 0) scale(1, 1)'>
                                    <path d = 'M 0, 20 L 0, 18 L 60, 18 L 60, 20 Z' stroke-width = '1' fill = '#ccc' stroke = 'none' stroke-dasharray = ''></path>
                                    <path d = 'M 0, 0 L 0, 20 M 60, 20 L 60, 0' stroke-width = '1' fill = 'white' stroke = '#ccc' stroke-dasharray = ''></path>
                                    <rect x = '6.25' y = '20' width = '47.5' height = '30' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect x = '6.25' y = '50' width = '23.75' height = '2' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect x = '30' y = '50' width = '23.75' height = '2' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <path d = 'M 6.25, 52 L 6.25, 75.75 A 23.75 23.75, 0, 0, 0, 30 52 A 23.75 23.75, 0, 0, 0, 53.75 75.75 L 53.75, 52' stroke-width = '1' fill = 'white' stroke = '#494646'></path>
                                    <rect class = 'draggable' x = '0' y = '0' width = '60' height = '20'></rect>
                                </g>
                            </svg>
                            <div class = 'modelAdd'>
                                <input type = 'button' value = '添加' onclick = 'addModel(this)'>
                            </div>
                        </div>
                        <div id = 'bathroomCabinet_slide' class = 'modelBox bathroomCabinet'>
                            <div class = 'modelTitle'>挂墙式滑动浴室柜</div>
                            <svg xmlns = 'http://www.w3.org/2000/svg' version = '1.1'>
                                <g transform = 'translate(54.15, 44.4) rotate(0, 0, 0) scale(1, 1)'>
                                    <path d = 'M 0, 20 L 0, 18 L 60, 18 L 60, 20 Z' stroke-width = '1' fill = '#ccc' stroke = 'none' stroke-dasharray = ''></path>
                                    <path d = 'M 0, 0 L 0, 20 M 60, 20 L 60, 0' stroke-width = '1' fill = 'white' stroke = '#ccc' stroke-dasharray = ''></path>
                                    <rect x = '6.25' y = '20' width = '47.5' height = '30' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect x = '6.25' y = '50' width = '47.5' height = '2' style = 'fill:url(#hatch); stroke:#494646; stroke-width:1; '></rect>
                                    <rect class = 'draggable' x = '0' y = '0' width = '60' height = '20'></rect>
                                </g>
                            </svg>
                            <div class = 'modelAdd'>
                                <input type = 'button' value = '添加' onclick = 'addModel(this)'>
                            </div>
                        </div>
                        <div id = 'washStand_rect' class = 'modelBox washStand'>
                            <div class = 'modelTitle'>方形洗手台</div>
                            <svg xmlns = 'http://www.w3.org/2000/svg' version = '1.1'>
                                <g transform = 'translate(49.15, 45.4) rotate(0, 0, 0) scale(1, 1)'>
                                    <rect x = '0' y = '0' width = '70' height = '50' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect x = '10' y = '16' width = '50' height = '24' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <circle cx = '35' cy = '28' r = '6' style = 'fill:white; stroke:#494646; stroke-width:1; '></circle>
                                    <circle cx = '35' cy = '28' r = '4' style = 'fill:white; stroke:#494646; stroke-width:1; '></circle>
                                    <rect x = '32.5' y = '11.33' width = '5' height = '16' style = 'fill:white; stroke:#494646; stroke-width:1; opacity:1; '></rect>
                                    <rect x = '34.5' y = '11.33' width = '1' height = '6' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <circle cx = '35' cy = '7' r = '5' style = 'fill:white; stroke:#494646; stroke-width:1; '></circle>
                                    <circle cx = '35' cy = '7' r = '2' style = 'fill:white; stroke:#494646; stroke-width:1; '></circle>
                                    <rect class = 'draggable' x = '0' y = '0' width = '70' height = '50'></rect>
                                </g>
                            </svg>
                            <div class = 'modelAdd'>
                                <input type = 'button' value = '添加' onclick = 'addModel(this)'>
                            </div>
                        </div>
                        <div id = 'toilet_1' class = 'modelBox toilet'>
                            <div class = 'modelTitle'>马桶</div>
                            <svg xmlns = 'http://www.w3.org/2000/svg' version = '1.1'>
                                <g transform = 'translate(64.15, 30.4) rotate(0, 0, 0) scale(1, 1)'>
                                    <line x1 = '5' y1 = '25' x2 = '5' y2 = '31' style = 'fill:white; stroke:#494646; stroke-width:1; '></line>
                                    <line x1 = '35' y1 = '25' x2 = '35' y2 = '31' style = 'fill:white; stroke:#494646; stroke-width:1; '></line>
                                    <ellipse cx = '20' cy = '50' rx = '20' ry = '27.5' style = 'fill:white; stroke:#494646; stroke-width:1; '></ellipse>
                                    <ellipse cx = '20' cy = '50' rx = '18' ry = '25.5' style = 'fill:white; stroke:#494646; stroke-width:1; '></ellipse>
                                    <rect x = '0' y = '0' rx = '4' ry = '4' width = '40' height = '25' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect x = '2' y = '2' rx = '4' ry = '4' width = '36' height = '21' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect class = 'draggable' x = '0' y = '0' width = '40' height = '80'></rect>
                                </g>
                            </svg>
                            <div class = 'modelAdd'>
                                <input type = 'button' value = '添加' onclick = 'addModel(this)'>
                            </div>
                        </div>
                        <div id = 'bathtub_1' class = 'modelBox bathtub'>
                            <div class = 'modelTitle'>浴缸</div>
                            <svg xmlns = 'http://www.w3.org/2000/svg' version = '1.1'>
                                <g transform = 'translate(56.15, 7.4) rotate(0, 0, 0) scale(0.7, 0.7)'>
                                    <rect x = '0' y = '0' width = '80' height = '180' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect x = '4' y = '4' rx = '2' ry = '2' width = '72' height = '172' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <rect x = '10' y = '15' rx = '20' ry = '20' width = '60' height = '150' style = 'fill:white; stroke:#494646; stroke-width:1; '></rect>
                                    <circle cx = '40' cy = '145' r = '4' style = 'fill:white; stroke:#494646; stroke-width:1; '></circle>
                                    <rect class = 'draggable' x = '0' y = '0' width = '80' height = '180'></rect>
                                </g>
                            </svg>
                            <div class = 'modelAdd'>
                                <input type = 'button' value = '添加' onclick = 'addModel(this)'>
                            </div>
                        </div>
                        {% for model in models %}
                            <div id = "{{ model['type'] + loop.index|string }}" class = "{{ 'modelBox ' + model['type'] }}">
                                <div class = 'modelTitle'>
                                    {{ model['name'] }}
                                </div>
                                <svg xmlns = 'http://www.w3.org/2000/svg' version = '1.1'>
                                    {{ model['code']|safe }}
                                </svg>
                                <div class = 'modelAdd'>
                                    {% if g.user['status'] == 1 %}
                                        <input modelid = "{{ model['id'] }}" type = 'button' value = '删除' onclick = 'deleteModel(this)'>
                                    {% endif %}
                                    <input type = 'button' value = '添加' onclick = 'addModel(this)'>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
                <div id = 'modelBankNav'>
                    <div id = 'sideNav' onclick = 'ChooseModel(this)' title = '展开模型库' hide = 'true'>
                        <i onclick = "" class = 'iconfont icon-xiala'></i>
                        <label>模型库</label>
                    </div>
                </div>
            </div>
        </div>
        <div id = 'templateShow'>
            <div id = 'templatePreview'>
                <label>当前选择模型：无</label>
                <div id = 'scaleBarBox'>
                    <label>比例尺：</label>
                    <svg xmlns = 'http://www.w3.org/2000/svg' version = '1.1'>
                        <g id = 'scaleBar' transform = 'translate(0, 0) rotate(0, 0, 0) scale(1, 1)'>
                            <text x = '87.81' y = '16'>1m</text>
                            <polyline points = '150, 14 150, 22 50, 22 50, 14'></polyline>
                        </g>
                    </svg>
                </div>
                <div id = 'templateImage'>
                    <svg id = 'viewBox' xmlns = 'http://www.w3.org/2000/svg' version = '1.1' onmousewheel = 'changeScale()'>
                        <defs>
                            <pattern id = 'hatch' width = '5' height = '5' patternTransform = 'rotate(50 0 0)' patternUnits = 'userSpaceOnUse'>
                                <path d = 'M 0 0 L 0 5 M 10 0 L 10 10 Z' style = 'stroke:#666; stroke-width:5;'></path>
                            </pattern>
                            <pattern id = 'floor_1' width = '40' height = '40' patternUnits = 'userSpaceOnUse'>
                                <image xlink:href = "{{ url_for('static', filename = 'images/template/floor/1.jpg') }}" x = '0' y = '0' width = '50' height = '50'></image>
                            </pattern>
                            <pattern id = 'floor_2' width = '40' height = '40' patternUnits = 'userSpaceOnUse'>
                                <image xlink:href = "{{ url_for('static', filename = 'images/template/floor/2.jpg') }}" x = '0' y = '0' width = '50' height = '50'></image>
                            </pattern>
                            <pattern id = 'floor_3' width = '40' height = '40' patternUnits = 'userSpaceOnUse'>
                                <image xlink:href = "{{ url_for('static', filename = 'images/template/floor/3.jpg') }}" x = '0' y = '0' width = '50' height = '50'></image>
                            </pattern>
                            <pattern id = 'floor_4' width = '40' height = '40' patternUnits = 'userSpaceOnUse'>
                                <image xlink:href = "{{ url_for('static', filename = 'images/template/floor/4.jpg') }}" x = '0' y = '0' width = '50' height = '50'></image>
                            </pattern>
                        </defs>
                        <rect id = 'layoutBorder' x = '0' y = '0' width = '1053.69' height = '601.912' style = "fill: rgb(242,238,229); stroke-width: 1; stroke: black; z-index: 3;" />
                        
                    </svg>
                </div>
            </div>
        </div>
    </div>
	<script>
        default_scale = 20;
        scale_rate = 1;
        grid_scale = 20; //网格大小
        var w = false, h = false; //房间宽高设置情况
        var mode = 1; //1：选择模式； 2：拖动模式。
        view = document.getElementById('viewBox');
        var dragMap=[];
        window.onload = function() {
            mouseoverFunc();
            drawGrid();
            showModels('door');
        }
        function showModels(type) {
            models = document.getElementsByClassName('modelBox');
            addBox = document.getElementById('addModelBox');
            for(var i = 0; i < models.length; i++) {
                if(addBox == models[i])
                    continue;
                models[i].style.display = 'none';
            }
            types = document.getElementsByClassName(type);
            for(var i = 0; i < types.length; i++) {
                types[i].style.display = 'flex';
            }
        }
        function selectPage(id) {
            tem = document.getElementById('template_label');
            mod = document.getElementById('model_label');
            temPage = document.getElementById('template_page');
            modPage = document.getElementById('model_page');
            if(id == 'template_label') {
                tem.setAttribute('class', 'label_selected');
                mod.setAttribute('class', 'label_unselected');
                temPage.setAttribute('style', '');
                modPage.setAttribute('style', 'display: none');
            } else if(id == 'model_label') {
                tem.setAttribute('class', 'label_unselected');
                mod.setAttribute('class', 'label_selected');
                temPage.setAttribute('style', 'display: none');
                modPage.setAttribute('style', '');
            }
        }
        function selectFloor(e) {
            floors = document.getElementsByClassName('floorBox');
            input = document.getElementById('floorInput');
            room = document.getElementById('layoutWallObj');
            if(room) {
                room.style.fill = "url(#floor_" + e.getAttribute('id').split('_')[0] + ")";
                for(var i = 0; i < floors.length; i++) {
                    if(floors[i] == e) {
                        input.value = e.getAttribute('id').split('_')[0];
                        e.setAttribute('class', 'floorBox floorSelected');
                    } else {
                        floors[i].setAttribute('class', 'floorBox');
                    }
                }
            }
        }
        function selectColor(e) {
            colors = document.getElementsByClassName('colorBox');
            input = document.getElementById('colorInput');
            for(var i = 0; i < colors.length; i++) {
                if(colors[i] == e) {
                    input.value = e.getAttribute('id').split('_')[0];
                    e.setAttribute('class', 'colorBox colorSelected');
                } else {
                    colors[i].setAttribute('class', 'colorBox');
                }
            }
        }
        function ChooseModel(e) {
            if(e.getAttribute('hide') == 'true') {
                div = document.getElementById('modelBank');
                div.setAttribute('id', 'modelBank_show');
                e.setAttribute('hide', false);
                e.childNodes[1].style.transform = 'rotate(90deg)';
            } else {
                div = document.getElementById('modelBank_show');
                div.setAttribute('id', 'modelBank');
                e.setAttribute('hide', true);
                e.childNodes[1].style.transform = 'rotate(-90deg)';
            }
        }
        function deleteModel(e) {
            id = e.getAttribute('modelid');
            href = "{{ url_for('map.smartLayout_deleteModel', id = '-1') }}";
            href = href.replace(/-1/, id);
            window.location.href = href;
        }
        function addModel(e) {
            g = e.parentNode.previousElementSibling.childNodes[1];
            model_name = e.parentNode.previousElementSibling.previousElementSibling.innerHTML;
            document.getElementById('templatePreview').childNodes[1].innerHTML = "当前选择模型：" + model_name;
            var newG = g.cloneNode(true);
            newG.setAttribute('transform', 'translate(0, 0) rotate(0, 0, 0) scale(1, 1)');
            type = document.getElementById('modelMenu').childNodes[3].value;
            newG.setAttribute('model_type', type);
            newG.setAttribute('model_name', model_name);
            newG.setAttribute('rotateAngle', 0);
            newG.onclick = function() {
                selectObj(newG, 1);
            }
            view.appendChild(newG);
            dragMap.push({obj:newG, drag:createDrag(newG)});
        }
        function createDrag(e) {
            var draggable = new PlainDraggable(e);
            draggable.containment = document.getElementById('layoutBorder');
            draggable.onDragStart = function() {
                obj = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                for(var i = 0; i < dragMap.length ; i++) {
                    let key = dragMap[i];
                    if(key.drag == draggable) 
                        obj = key.obj;
                }
                attr = obj.getAttribute('transform').replace(/rotate\(([\-\s0-9]*)\)/, "rotate(" + 0 + ")");
                newG.setAttribute('transform', attr);
            };
            draggable.onDragEnd = function() {
                obj = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                for(var i = 0; i < dragMap.length ; i++) {
                    let key = dragMap[i];
                    if(key.drag == draggable) 
                        obj = key.obj;
                }
                changeModel(obj, 'angle', obj.getAttribute('rotateAngle'));
            };
            if(document.getElementById('layoutWall') != null) {
                if(type == 'door' | type == 'window') {
                    // draggable.snap = {
                    //     targets: [document.getElementById('layoutWallBorder') ],
                    //     edge: inside
                    // };
                    draggable.snap = document.getElementById('layoutWallBorder');
                    // console.log(draggable.snap);
                }
                else {
                    draggable.snap = document.getElementById('layoutWallContent');
                }
            }
            draggable.disabled = true;
            e.ondblclick = function() {
                dragEvent(e);
            };
            return draggable;
        }
        function dragEvent(e) {
            for(var i = 0; i < dragMap.length ; i++) {
                let key = dragMap[i];
                if(key.obj == e) {
                    key.drag.disabled = !key.drag.disabled;
                }
                else {
                    key.drag.disabled = true;
                }
            }
        }
        formObj = document.getElementsByTagName('form')[0];
        function choiceCheck() {
            options = document.getElementsByName('style');
            num = 0;
            for(var i = 1; i < options.length; i++) {
                if(options[i].checked)
                    num++;
            }
            if(num == 0) {
                alert("请选择至少一种房间风格！");
                return false;
            }
            else if(num > 3) {
                alert("只能选择最多三种房间风格！");
                return false;
            }
            return true;
        }
        formObj.onsubmit = function() {
            return choiceCheck();
        }
        function mouseoverFunc() {
            graphs = document.getElementsByTagNameNS('http://www.w3.org/2000/svg', 'g');
            for(var i = 0; i < graphs.length; i++) {
                if(graphs[i].getAttribute('id') == 'scaleBar' | graphs[i].getAttribute('id') == 'layoutWall')
                    continue;
                graphs[i].onmouseover = function() {
                    this.style.cursor = 'pointer';
                    if(this.childNodes[this.childNodes.length - 2].getAttribute('class') == 'draggable')
                        this.childNodes[this.childNodes.length - 2].setAttribute('class', 'draggable_hover');
                }
                graphs[i].onmouseleave = function() {
                    this.style.cursor = 'default';
                    if(this.childNodes[this.childNodes.length - 2].getAttribute('class') == 'draggable_hover')
                        this.childNodes[this.childNodes.length - 2].setAttribute('class', 'draggable');
                }
            }
        }
        function drawGrid() {
            border = document.getElementById('layoutBorder');
            leftTop_x = parseFloat(border.getAttribute('x')) + parseFloat(border.style['stroke-width'])/2.0;
            leftTop_y = parseFloat(border.getAttribute('y')) + parseFloat(border.style['stroke-width'])/2.0;
            rightBottom_x = leftTop_x + parseFloat(border.getAttribute('width')) - parseFloat(border.style['stroke-width']);
            rightBottom_y = leftTop_y + parseFloat(border.getAttribute('height')) - parseFloat(border.style['stroke-width']);
            for(var i = leftTop_x; i < rightBottom_x; i += grid_scale) {
                if(i == leftTop_x)
                    continue;
                if((i - leftTop_x) % (5 * grid_scale) == 0) {
                    line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('class', 'layoutGrid_bline');
                    line.setAttribute('x1', i);
                    line.setAttribute('y1', leftTop_y);
                    line.setAttribute('x2', i);
                    line.setAttribute('y2', rightBottom_y);
                    // grid.appendChild(line);
                    view.appendChild(line);
                } else {
                    line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('class', 'layoutGrid_line');
                    line.setAttribute('x1', i);
                    line.setAttribute('y1', leftTop_y);
                    line.setAttribute('x2', i);
                    line.setAttribute('y2', rightBottom_y);
                    // grid.appendChild(line);
                    view.appendChild(line);
                }
            }
            for(var j = leftTop_y; j < rightBottom_y; j += grid_scale) {
                if(j == leftTop_y)
                    continue;
                if((j - leftTop_y) % (5 * grid_scale) == 0) {
                    line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('class', 'layoutGrid_bline');
                    line.setAttribute('x1', leftTop_x);
                    line.setAttribute('y1', j);
                    line.setAttribute('x2', rightBottom_x);
                    line.setAttribute('y2', j);
                    // grid.appendChild(line);
                    view.appendChild(line);
                } else {
                    line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('class', 'layoutGrid_line');
                    line.setAttribute('x1', leftTop_x);
                    line.setAttribute('y1', j);
                    line.setAttribute('x2', rightBottom_x);
                    line.setAttribute('y2', j);
                    // grid.appendChild(line);
                    view.appendChild(line);
                }
            }
        }
        function changeScale() {
            var ev = window.event;
            var down;
            down = ev.wheelDelta > 0 ? false : true;
            if(down) {
                if(scale_rate + 0.1 <= 2)
                    scale_rate += 0.1;
            }
            else {
                if(scale_rate - 0.1 >=0)
                    scale_rate -= 0.1;
            }
            grid_scale = default_scale * scale_rate;
        }
        function mdoelType_CN(type) {
            switch(type) {
                case 'door': return '门';
                case 'window': return '窗';
                case 'sofa': return '沙发';
                case 'bed': return '床';
                case 'desk': return '桌子';
                case 'chair': return '椅子|凳子';
                case 'cabinetRack': return '柜架';
                case 'cupboard': return '橱柜';
                case 'bathroomCabinet': return '浴室柜';
                case 'washStand': return '洗手台';
                case 'toilet': return '马桶';
                case 'bathtub': return '浴缸';
                default: return;
            }
        }
        function getCenter(e) {
            x_lt = 0;
            y_lt = 0;
            if(e.getAttribute('transform') != null) {
                x_lt = e.getAttribute('transform').split('(')[4].split(')')[0].split(' ')[0];
                y_lt = e.getAttribute('transform').split('(')[4].split(')')[0].split(' ')[1];
            }
            x_ct = parseFloat(x_lt) + e.getBBox().width/2.0;
            y_ct = parseFloat(y_lt) + e.getBBox().height/2.0;
            console.log("w:" + e.getBoundingClientRect().width + ",h:" + e.getBoundingClientRect().height);
            console.log(e);
            if(parseInt(e.getAttribute('rotateAngle')) % 180 == 0){
                var ct = {x: x_ct, y: y_ct};
            }
            else {
                var ct = {x: y_ct, y: x_ct};
            }
            console.log("x:" + ct.x + ", y:" + ct.y);
            for(var i = 0; i < dragMap.length ; i++) {
                let key = dragMap[i];
                if(key.obj == e) {
                    console.log(key.drag.rect);
                }
            }
            return ct;
        }
        function changeModel(e, type, val) {
            oldG = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            oldG = e;
            if(type == 'scale') {
                attr = e.getAttribute('transform').replace(/scale\(([\.\s0-9]*)\)/, "scale(" + val + ")");
                e.setAttribute('transform', attr);
            }
            else if(type == 'angle') {
                ct = getCenter(e);
                console.log("x:" + ct.x + ", y:" + ct.y);
                // console.log(e.getAttribute('transform'));
                if(e.getAttribute('transform') != null) {
                    attr = e.getAttribute('transform').replace(/rotate\(([\-\s0-9]*)\)/, "rotate(" + val + " " + ct.x + " " + ct.y + ")");
                    e.setAttribute('transform', attr);
                }
                // console.log(e.getAttribute('transform'));
            }
            for(var i = 0; i < dragMap.length ; i++) {
                let key = dragMap[i];
                if(key.obj == oldG) {
                    // e.removeAttribute('class');
                    key.obj = e;
                    key.drag = createDrag(e);
                }
            }
            for(var i = 0; i < dragMap.length ; i++) {
                let key = dragMap[i];
                if(key.obj == e) 
                    ;
                    // console.log(key.drag);
            }
        }
        function selectObj(e, type) {
            if(type == 1) {
                document.getElementById('templatePreview').childNodes[1].innerHTML = "当前选择模型：" + e.getAttribute('model_name');
                document.getElementById('model_label').click();
                nameBox = document.getElementById('modelName_inputBox');
                nameBox.childNodes[3].value = e.getAttribute('model_name');
                typeBox = document.getElementById('type_inputBox');
                typeBox.childNodes[3].value = mdoelType_CN(e.getAttribute('model_type'));
                angleBox = document.getElementById('angle_inputBox').childNodes[3];
                angleBox.value = e.getAttribute('transform').split('(')[2].split(')')[0].split(' ')[0];
                angleBox.removeEventListener('input', function() {
                    e.setAttribute('rotateAngle', angleBox.value);
                    changeModel(e, 'angle', angleBox.value);
                });
                angleBox.oninput = function() {
                    e.setAttribute('rotateAngle', angleBox.value);
                    changeModel(e, 'angle', angleBox.value);
                };
                scaleBox = document.getElementById('scale_inputBox').childNodes[3];
                scaleBox.value = e.getAttribute('transform').split('(')[3].split(')')[0].split(' ')[0];
                // console.log(scaleBox.value);
                scaleBox.removeEventListener('input', function() {
                    changeModel(e, 'scale', scaleBox.value);
                });
                scaleBox.oninput = function() {
                    changeModel(e, 'scale', scaleBox.value);
                };
            }
        }
        function roomSizeSet(e, type) {
            if(type == 1) {
                if(e.value > 10)
                    e.value = 10;
                if(e.value <= 0)
                    e.value = 2;
                w = e.value;
            } else if(type == 2) {
                if(e.value > 5.6)
                    e.value = 5.6;
                if(e.value <= 0)
                    e.value = 2;
                h = e.value;
            }
            if(w&&h) {
                floor = 'url(#floor_1)';
                oldWallGraph = document.getElementById('layoutWall');
                oldWallContent = document.getElementById('layoutWallObj');
                if(oldWallGraph != null) {
                    floor = oldWallContent.style.fill; //oldWallGraph ! = oldWall
                    oldWallGraph = document.getElementById('layoutWall');
                    oldWallGraph.remove();
                }
                wallGraph = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                wallGraph.setAttribute('id', 'layoutWall');
                wallGraph.setAttribute('transform', 'translate(0, 0) rotate(0, 0, 0) scale(1, 1)');
                view.appendChild(wallGraph);
                draggable = new PlainDraggable(wallGraph);
                draggable.containment = view;
                draggable.disabled = true;
                wallGraph.onclick = function() {
                    selectObj(wallGraph, 2);
                }
                wallGraph.ondblclick = function() {
                    if(draggable.disabled == false)
                        draggable.disabled = true;
                    else
                        draggable.disabled = false;
                }
                // 设置墙体对象
                wall = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                wall.setAttribute('id', 'layoutWallObj');
                wall.setAttribute('x', 10);
                wall.setAttribute('y', 10);
                wall.setAttribute('width', w * 5 * grid_scale + 20);
                wall.setAttribute('height', h * 5 * grid_scale + 20);
                input = document.getElementById('floorInput');
                wall.style.fill = floor;
                wallGraph.appendChild(wall);
                // 设置墙边框
                wallBorder = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                wallBorder.setAttribute('id', 'layoutWallBorder');
                wallBorder.setAttribute('x', 0);
                wallBorder.setAttribute('y', 0);
                wallBorder.setAttribute('width', w * 5 * grid_scale + 40);
                wallBorder.setAttribute('height', h * 5 * grid_scale + 40);
                wallBorder.setAttribute('style', 'stroke: none; opacity: 0;');
                wallGraph.appendChild(wallBorder);
                // 设置墙内区域
                wallContent = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                wallContent.setAttribute('id', 'layoutWallContent');
                wallContent.setAttribute('x', 21);
                wallContent.setAttribute('y', 21);
                wallContent.setAttribute('width', w * 5 * grid_scale - 2);
                wallContent.setAttribute('height', h * 5 * grid_scale - 2);
                wallContent.setAttribute('style', 'stroke: none; opacity: 0;');
                input = document.getElementById('floorInput');
                wallGraph.appendChild(wallContent);
            }
        }
    </script>
{% endblock %}